<?xml version="1.0"?>
<!--

Configuration details for the integration scripts which fetch staff, group
and project details from the Web Team's Staff Module and then clean it so
that it's ready for harvest by Mint as part of the Research Data Catalogue.

-->

<mintIntConfig>

  <locations>
    <logs>/home/mike/workspace/RDC Mint Integration/test/logs</logs>
    <harvest>/home/mike/workspace/RDC Mint Integration/test/harvest</harvest>
    <working>/home/mike/workspace/RDC Mint Integration/test/working</working>
  </locations>

  <!-- Connection to the Staff Module database -->

  <connection>
    <type>sqlserver</type>
    <server>138.25.225.147</server>
    <port>1433</port>
    <database>Staff</database>
    <domain>ADSROOT</domain>
    <user>960700</user>
    <password>FlumM3x</password>
  </connection>


  <!-- Templates for building URLs which point back to a researcher's
       public profile page -->

  <landingPageURLs>
    <faculty name="FEIT" code="FEIT">http://cfsites1.uts.edu.au/feit/staff/listing/details.cfm?StaffId=$ID</faculty>
    <faculty name="FASS" code="FASS">http://cfsites1.uts.edu.au/fass/staff/listing/details.cfm?StaffId=$ID</faculty>
    <faculty name="Science" code="NO">http://cfsites1.uts.edu.au/science/staff/details.cfm?StaffID=$ID</faculty>
    <faculty name="Law" code="LO">http://cfsites1.uts.edu.au/law/staff/details.cfm?StaffId=$ID</faculty>
    <faculty name="DAB" code="AO">http://cfsites1.uts.edu.au/dab/staff/details.cfm?StaffId=$ID</faculty>
    <faculty name="Health" code="JO">http://cfsites1.uts.edu.au/nmh/staff/academic-details.cfm?StaffId=$ID</faculty>
    <faculty name="Business" code="BO">http://cfsites1.uts.edu.au/business/staff/details.cfm?StaffId=$ID</faculty>
  </landingPageURLs>


  <!-- Patterns for cleaning up the Group (AOU) names and for ignoring 
       deprecated groups -->

  <groupTidy>

    <!-- AOU with names matching this regexp will be ignored -->
    <ignore>DONT USE</ignore>


    <prefixes>
      <prefix old="JO" new="FOH" />
      <prefix old="NMH" new="FOH" />
    </prefixes>


  </groupTidy>



  <!-- SQL queries and column details for each of the feeds from the Staff
       module. -->
  <queries>

    <query name="Groups">
      
      <infields>
  	<field name="ID" unique_ID="1" />
  	<field name="Name" />
  	<field name="Parent_Group_ID" />
  	<field name="Parent_Group_Name" />
      </infields>
      
      <outfields name="raw" file="Groups.raw.csv">	
  	<field name="ID" />
  	<field name="Name" />
  	<field name="Email" />
  	<field name="Phone" />
  	<field name="Parent_Group_ID" />
  	<field name="URI" />
  	<field name="NLA_Party_Identifier" />
  	<field name="Homepage" />
  	<field name="Description" />
      </outfields>

      <outfields name="harvest" file="Groups.csv">	
  	<field name="ID" />
  	<field name="Name" />
  	<field name="Email" />
  	<field name="Phone" />
  	<field name="Parent_Group_ID" />
  	<field name="URI" />
  	<field name="NLA_Party_Identifier" />
  	<field name="Homepage" />
  	<field name="Description" />
      </outfields>
      
      <sql>
SELECT DISTINCT rm4xaoul.caou_code,
	rm4xaoul.caou_name,
	   rm4xaoul.cmanage_code,
	   rm4xaoul.cmanage_name
FROM rm4xaoul
      </sql>
    </query>

    <!-- A separate query to get a list of the MUs, which the 
         clean_mint_parties.pl script will fold into Groups -->

    <query name="ManagingUnits">
      
      <infields>
  	<field name="ID" unique_ID="1" />
  	<field name="Name" />
      </infields>
      
      <outfields name="raw" file="MUs.csv">	
  	<field name="ID" />
  	<field name="Name" />
      </outfields>
      
      <sql>
SELECT DISTINCT rm4xaoul.cmanage_code, rm4xaoul.cmanage_name
FROM rm4xaoul
      </sql>
    </query>


    <query name="People">

      <infields>
    	<field name="ID" unique_ID="1" />
    	<field name="SMID" />
    	<field name="Given_Name" />
    	<field name="Family_Name" />
    	<field name="Pref_name" />
    	<field name="Honorific" />
    	<field name="Email" />
    	<field name="Job_Title" />
    	<field name="GroupID_1" />
    	<field name="ANZSRC_FOR" fors="3" />
    	<field name="Description" />
      </infields>
    
      <outfields name="raw" file="People.raw.csv">
    	<field name="ID" />
    	<field name="SMID" />
    	<field name="Given_Name" />
    	<field name="Other_Names" />
    	<field name="Family_Name" />
    	<field name="Pref_name" />
    	<field name="Honorific" />
    	<field name="Email" />
    	<field name="Job_Title" />
    	<field name="GroupID_1" />
    	<field name="GroupID_2" />
    	<field name="GroupID_3" />
    	<field name="ANZSRC_FOR_1" />
    	<field name="ANZSRC_FOR_2" />
    	<field name="ANZSRC_FOR_3" />
    	<field name="URI" />
    	<field name="NLA_Party_Identifier" />
    	<field name="ResearcherID" />
    	<field name="openID" />
    	<field name="Personal_URI" />
    	<field name="Personal_Homepage" />
    	<field name="Staff_Profile_Homepage" />
    	<field name="Description" />
      </outfields>

      <outfields name="harvest" file="People.csv">
    	<field name="ID" />
    	<field name="Given_Name" />
    	<field name="Other_Names" />
    	<field name="Family_Name" />
    	<field name="Pref_name" />
    	<field name="Honorific">
	  <convert from="ASPRO" to="Associate Professor" />
	  <convert from="DR."   to="Doctor" />
	  <convert from="EMPRO" to="Emeritus Professor" />
	  <convert from="MISS"  to="Miss" />
	  <convert from="MR."   to="Mr." />
	  <convert from="MRS."  to="Mrs." />
	  <convert from="PROF"  to="Professor" />
	</field>
    	<field name="Email" />
    	<field name="Job_Title" />
    	<field name="GroupID_1" />
    	<field name="GroupID_2" />
    	<field name="GroupID_3" />
    	<field name="ANZSRC_FOR_1" />
    	<field name="ANZSRC_FOR_2" />
    	<field name="ANZSRC_FOR_3" />
    	<field name="URI" />
    	<field name="NLA_Party_Identifier" />
    	<field name="ResearcherID" />
    	<field name="openID" />
    	<field name="Personal_URI" />
    	<field name="Personal_Homepage" />
    	<field name="Staff_Profile_Homepage" />
    	<field name="Description" />
      </outfields>

      
      <sql>
SELECT
    staff.UTSStaffId,
    staff.id,
    staff.FirstName,
    staff.FamilyName,
    staff.PreferredName,
    staff.title,
    staff.email,
    staff.NeoPosition,
    staff.NeoUnit,
    rm4xcla.ccode_code,
    staff.biography
FROM staff
    LEFT JOIN rm4xcla ON staff.UTSStaffId = rm4xcla.cperson_code
WHERE (((rm4xcla.ctype) = 'FOR-08'));

    </sql>
    
    </query>

    <query name="Projects">

      <infields>
	<field name="ID" />
	<field name="Name" />
	<field name="Description" />
	<field name="GrantID" />
	<field name="GrantType" />
	<field name="Primary_Investigator" />
	<field name="Status" />
	<field name="StartDate" />
	<field name="EndDate" />
	<field name="FORS" fors="3" />
	<field name="Current" />
	<field name="Private" />
	<field name="Closed" />
      </infields>

      <outfields name="raw" file="Projects.raw.csv">
	<field name="ID" />
	<field name="Name" />
	<field name="Type" />
	<field name="StartDate" />
	<field name="EndDate" />
	<field name="Description" />
	<field name="Primary_Investigator" />
	<field name="Website" />
	<field name="FORS_1" />
	<field name="FORS_2" />
	<field name="FORS_3" />
	<field name="GrantID" />
      </outfields>
      <sql>
SELECT
    rm4xpro.ccode,
    rm4xpro.sprotitle,
    rm4xpro.mdesc,
    rm4xpro.sfolio,
    rm4xpro.sgranttype,
    rm4xpro.sintcont_code,
    rm4xpro.sstatus_name,
    rm4xpro.dstart,
    rm4xpro.dend,
    rm4xcla.ccode_code,
    rm4xpro.lcurrent_logic,
    rm4xpro.lprivate_logic,
    rm4xpro.lclose_logic
FROM rm4xpro
LEFT JOIN rm4xcla ON rm4xpro.cproject_pk = rm4xcla.cproject_fk
WHERE
    (((rm4xpro.sstatus_name)='Approved') AND
    ((rm4xcla.ctype)='FOR-08') AND
    ((rm4xpro.lcurrent_logic)='Yes') AND
    ((rm4xpro.lprivate_logic)='No') AND
    ((rm4xpro.dend)>CURRENT_TIMESTAMP))
      </sql>

    </query>



  </queries>

  
</mintIntConfig>
